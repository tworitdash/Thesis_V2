function [Eth, Eph] = FF_apertureFSCir(N, Dm, theta, phi, F, er, mur, R) 

c0 = 3e8;
v = c0./sqrt(er);

er0 = 8.85418782e-12; % Free space permittivity
mu0 = 1.25663706e-6;  % Free Space Permeability

epsilon = er * er0;
mu = mur .* mu0;

beta = 2 * pi * F / v;


Str = load('Xmn_azimuthal_inc_TE.mat');

str = Str.xmn_TE;

for i = 1:N

xmn = str(i).xmn;
m = str(i).m;
mode = str(i).mode;

beta_rhop = xmn./R;

beta_z = -1j.*sqrt(-(beta.^2 - beta_rhop.^2));

ZTE = 2 * pi * F * mu ./ beta_z;

Nup = 1j .* beta_z ./ beta_rhop.^2 * ZTE;

k0 = (2 * pi * F)/c0;

kx = k0 .* sin(theta) .* cos(phi);
ky = k0 .* sin(theta) .* sin(phi);

kz = (-1j)*sqrt(-(k0.^2 - kx.^2 - ky.^2));

Nu = sqrt((kx.^2 + ky.^2));

Psi = acos(kx./Nu);

for i = 1:size(Nu, 1)
    
    for k = 1:size(Nu, 2)

        I0(i, k) = Lommel(0, R, beta_rhop, Nu(i, k), m - 1, m - 1);
        I2(i, k) = Lommel(0, R, beta_rhop, Nu(i, k), m + 1, m + 1);

    end
end

E_ft_x = (Nup) .* Dm(i) .* pi .* beta_rhop .* sin(2 * Psi) .* I2;
E_ft_y = (Nup) .* Dm(i) .* pi .* beta_rhop .* (I0 + cos(2 .* Psi) .* I2);


c2 = 1j .* k0 / (4 * pi);

Eth(i) = c2 .* (E_ft_x .* cos(phi) + E_ft_y .* sin(phi));
Eph(i) = c2 .* cos(theta) .* (E_ft_y .* cos(phi) - E_ft_x .* sin(phi));


end

